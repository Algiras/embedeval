# Example: E-commerce Product Search
# Optimized for product catalog search and recommendations

test:
  name: "E-commerce Search Evaluation"
  description: "Testing retrieval for product search queries"

variants:
  # Fast for high-traffic search
  - id: search-fast
    name: "Fast Search"
    provider:
      type: openai
      apiKey: ${OPENAI_API_KEY}
      model: text-embedding-3-small
    strategy: baseline

  # With category boosting
  - id: search-categories
    name: "Category-Boosted Search"
    provider:
      type: openai
      apiKey: ${OPENAI_API_KEY}
      model: text-embedding-3-small
    strategy: hybrid-bm25
    config:
      # Boost exact category matches
      fieldWeights:
        title: 2.0
        description: 1.0
        category: 3.0
        brand: 1.5

  # High-quality recommendations
  - id: recommendations
    name: "Product Recommendations"
    provider:
      type: openai
      apiKey: ${OPENAI_API_KEY}
      model: text-embedding-3-large
    strategy: mmr-diversity
    config:
      # Ensure diverse results (not all same category)
      mmrLambda: 0.6
      diversityField: category

dataset: ./data/ecommerce-queries.jsonl
corpus: ./data/product-catalog.jsonl

# E-commerce specific metrics
metrics:
  - ndcg@5          # Top 5 results quality
  - ndcg@10         # Top 10 results quality
  - recall@5        # Find relevant products in top 5
  - recall@20       # Find relevant products in top 20
  - mrr@10          # First relevant product rank
  - hitRate@5       # At least one relevant in top 5

# Business rules
gates:
  # Must find at least one relevant product in top 5
  hitRate@5:
    min: 0.90
  
  # Average first relevant product should be in top 3
  mrr@10:
    min: 0.33

output:
  json: ./results/ecommerce-metrics.json
  dashboard: ./results/ecommerce-dashboard.html
  csv: ./results/ecommerce-report.csv

# A/B test configuration
abTest:
  trafficSplit: [0.5, 0.5]  # 50/50 split
  duration: 7d               # Run for 7 days
  primaryMetric: ndcg@5
  minSampleSize: 1000
