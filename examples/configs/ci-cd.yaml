# Example: CI/CD Integration
# Configuration for automated testing in CI/CD pipelines

test:
  name: "CI/CD Regression Test"
  description: "Automated evaluation with pass/fail gates"

variants:
  - id: baseline
    name: "Baseline Model"
    provider:
      type: ollama
      baseUrl: ${OLLAMA_HOST:-http://localhost:11434}
      model: nomic-embed-text
    strategy: baseline

  - id: candidate
    name: "Candidate Model"
    provider:
      type: ollama
      baseUrl: ${OLLAMA_HOST:-http://localhost:11434}
      model: ${CANDIDATE_MODEL:-nomic-embed-text}
    strategy: baseline

dataset: ${TEST_DATASET:-./examples/sample-queries.jsonl}
corpus: ${TEST_CORPUS:-./examples/sample-corpus.jsonl}

metrics:
  - ndcg@5
  - ndcg@10
  - recall@5
  - recall@10

# Pass/Fail Gates
gates:
  # Minimum NDCG@5 threshold
  ndcg@5:
    min: ${NDCG5_THRESHOLD:-0.70}
    compareTo: baseline
    maxRegression: ${MAX_REGRESSION:-0.05}  # Allow 5% regression
  
  # Minimum Recall@5 threshold
  recall@5:
    min: ${RECALL5_THRESHOLD:-0.65}
    compareTo: baseline
    maxRegression: ${MAX_REGRESSION:-0.05}
  
  # Latency gate (max 200ms average)
  latency:
    max: ${MAX_LATENCY_MS:-200}
    metric: avgLatency

output:
  json: ./ci-results/metrics.json
  csv: ./ci-results/metrics.csv
  # Exit code will be non-zero if gates fail

# Notifications (optional)
notifications:
  onFailure:
    - type: github
      repo: ${GITHUB_REPO}
    - type: slack
      webhook: ${SLACK_WEBHOOK_URL}
  onSuccess:
    - type: github
      repo: ${GITHUB_REPO}
